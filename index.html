<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>After School</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14"></script>
    <script src="script.js" type="module" defer></script>
  
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div id="app">
        
        <header v-if="view === 'store'">
    
            <div class="logo-container">
                <img src="images/Welcome.png" alt="Khan Bookstore Logo" class="logo">
                
            </div>
            <input type="text" class="search-bar" v-model="searchQuery" placeholder="Search for books...">
            <button id="sortToggleBtn" @click="toggleSort">{{ sortOrder === 'asc' ? 'Sort Descending' : 'Sort Ascending' }}</button>

            
            <div id="sortDropdown">
                <button class="dropdown-button">Sort By</button>
                <div id="sortDropdownContent">
                    <a @click="setSortCriterion('subject')">Subject</a>
                    <a @click="setSortCriterion('location')">Location</a>
                    <a @click="setSortCriterion('price')">Price</a>
                    <a @click="setSortCriterion('availability')">Availability</a>
                </div>
            </div>

            <button @click="goToCart" :disabled="cart.length === 0">
                <img src="images/cart.png" alt="Cart Icon" class="cart-icon"> Go to Cart ({{ cart.length }})
            </button>
        </header>

        
        <main v-if="view === 'store'" id="bookList">
            <div v-for="book in sortedBooks" :key="book.id" class="book">
                <img :src="book.image" :alt="book.subject" class="book-image">
                <h4>{{ book.subject }}</h4>
                <p>Location: {{ book.location }}</p>
                <p>Price: ${{ book.price }}</p>
                <p>Availability: {{ book.availability > 0 ? book.availability : 'Out of stock' }}</p>
                
                <!-- Add the rating stars here -->
                <div class="rating">
                    <i v-for="star in generateStars(book.rating, book.availability)" 
                       :key="star" 
                       class="fas fa-star"></i>
                    <i v-for="star in 5 - generateStars(book.rating, book.availability)" 
                       :key="'empty-' + star" 
                       class="far fa-star"></i>
                </div>
        
                <button :disabled="book.availability === 0" @click="addToCart(book)">Add to Cart</button>
            </div>
        </main>
        

       
            <main v-else-if="view === 'cart'" id="cartList">
                <h1 class="cart-title">Your Cart</h1>
                <div v-if="cart.length === 0" class="empty-cart-message">
                    <p>Your cart is empty.</p>
                </div>
                <div v-else class="cart-items">
                    <div v-for="item in cart" :key="item.id" class="cart-item">
                        <img :src="item.image" :alt="item.subject" class="cart-item-image">
                        <div class="cart-item-details">
                            <h4>{{ item.subject }}</h4>
                            <p>Quantity: {{ item.quantity }}</p>
                            <p>Total Price: ${{ item.quantity * item.price }}</p>
                            <button @click="removeOne(item)">Remove One</button>
                            
                        </div>
                    </div>
                </div>
                <div class="cart-buttons">
                    <button @click="proceedToPayment" :disabled="cart.length === 0">Proceed to Payment</button>
                    <button @click="goToStore">Back to Store</button>
                </div>
            </main>


        <!-- payment form -->
            <div v-if="view === 'payment'" id="paymentForm">
                <h1>Payment Information</h1>
                <form @submit.prevent="submitPayment">
                    <label for="name">Name:</label>
                    <input type="text" v-model="paymentInfo.name" required>
                    <span v-if="nameError" class="error-message">{{ nameError }}</span>
            
                    <label for="phone">Phone Number:</label>
                    <input type="text" v-model="paymentInfo.phone" required>
                    <span v-if="phoneError" class="error-message">{{ phoneError }}</span><br>
            
                    <button type="submit" :disabled="!isFormValid">Submit Payment</button>
                    <button type="button" @click="goToStore">Back to Store</button>
                </form>
            </div>
            
            
            
    </div>
</body>
</html>
